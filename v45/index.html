<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#111827"/>
  <title>ç™¾å®¶æ¨‚å‹ç‡è¨ˆç®—å™¨ï¼ˆv4.5 åˆ†æ”¯ç‰ˆ /v45ï¼‰</title>
  <link rel="manifest" href="./manifest.webmanifest">
  <style>
    :root { --bg:#0f172a; --card:#111827; --muted:#94a3b8; --accent:#22c55e; --text:#e5e7eb; --danger:#ef4444; }
    *{ box-sizing:border-box; } html,body{ margin:0; padding:0; background:var(--bg); color:var(--text);
    font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Noto Sans TC','PingFang TC','Hiragino Sans','Microsoft JhengHei',system-ui,sans-serif;}
    header{ padding:16px 16px 8px; text-align:center; } h1{ margin:0; font-size:20px; }
    .wrap{ max-width:980px; margin:0 auto; padding:10px; }
    .card{ background:var(--card); border:1px solid #1f2937; border-radius:12px; padding:14px; margin:10px; box-shadow:0 6px 24px rgba(0,0,0,.25); }
    label{ display:block; font-size:13px; color:var(--muted); margin-bottom:6px; }
    input[type=text], input[type=number]{ width:100%; padding:12px; border-radius:10px; border:1px solid #334155; background:#0b1220; color:var(--text); outline:none;}
    .row{ display:flex; gap:10px; flex-wrap:wrap; } .row > *{ flex:1 1 180px; }
    button{ background:#1f2937; color:var(--text); border:1px solid #374151; padding:10px 12px; border-radius:10px; cursor:pointer;}
    button.primary{ background:var(--accent); border-color:#16a34a; color:#06220f; font-weight:600; } button.danger{ background:#311316; border-color:#7f1d1d; color:#fecaca; }
    small{ color:var(--muted); } .stats{ display:flex; gap:10px; flex-wrap:wrap; }
    .stat{ flex:1 1 140px; background:#0b1220; border:1px solid #334155; border-radius:12px; padding:12px; text-align:center; }
    .stat h3{ margin:0; font-size:14px; color:var(--muted); } .stat .v{ font-size:24px; font-weight:700; margin-top:6px; }
    .chips{ margin-top:6px; } .chip{ display:inline-flex; align-items:center; gap:6px; border:1px dashed #334155; border-radius:999px; padding:5px 8px; margin:4px 6px 0 0; }
    .x{ cursor:pointer; color:#fca5a5; font-weight:700; } .hint{ font-size:12px; color:var(--muted); margin-top:4px; }
    table{ width:100%; border-collapse:collapse; } th,td{ border-bottom:1px solid #1f2937; padding:8px; font-size:12px; text-align:center; } th{ color:#94a3b8; font-weight:600; }
    .scrollX{ overflow-x:auto; -webkit-overflow-scrolling: touch; border:1px solid #334155; border-radius:10px; background:#0b1220; }
    .roadTitle{ display:flex; align-items:center; justify-content:space-between; margin-top:8px; }
    canvas.road{ width:100%; max-height:240px; }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <header><h1>ç™¾å®¶æ¨‚å‹ç‡è¨ˆç®—å™¨ï¼ˆv4.5 åˆ†æ”¯ç‰ˆï¼‰</h1></header>
  <div class="wrap">
    <div class="card">
      <div class="row" style="align-items:center;">
        <div style="flex:1 1 auto;"><label>å¿«é€Ÿå·¥å…·</label></div>
        <div style="display:flex; gap:8px; flex-wrap:wrap;">
          <button id="btnForceUpdate" class="danger">ğŸ”„ å¼·åˆ¶æ›´æ–°å¿«å–</button>
          <button id="btnForceClearAll">ğŸ§¹ æ¸…é™¤æ‰€æœ‰è³‡æ–™ï¼ˆå«æ­·å²èˆ‡è·¯åœ–ï¼‰</button>
        </div>
      </div>
      <small>é€™å€‹ v4.5 ç‰ˆæœ¬éƒ¨ç½²åœ¨ <b>/v45</b> å­è·¯å¾‘ï¼Œèˆ‡ v4.2 äº’ä¸å½±éŸ¿ã€‚</small>
    </div>

    <div class="card">
      <div class="row">
        <div><label>å‰¯æ•¸ (é è¨­ 8)</label><input id="decks" type="number" min="1" max="16" value="8"></div>
        <div><label>æ¨¡æ“¬å±€æ•¸ Trialsï¼ˆå»ºè­° 20000~60000ï¼‰</label><input id="trials" type="number" min="1000" step="1000" value="30000"></div>
        <div><label>å›ºå®šäº‚æ•¸ç¨®å­ï¼ˆå¯ç©ºç™½ï¼‰</label><input id="seed" type="number" placeholder="å¦‚ 20250831"></div>
      </div>
      <div style="margin-top:10px;">
        <label>è¼¸å…¥å·²é–‹ç‰Œï¼ˆé€£çºŒè¼¸å…¥å³å¯ï¼›T æˆ– 10 éƒ½ä»£è¡¨ 10ï¼‰</label>
        <input id="cards" type="text" placeholder="ä¾‹å¦‚ï¼šAK103QQ7">
        <div class="row" style="margin-top:10px;">
          <button id="btnAdd">åŠ å…¥å·²é–‹ç‰Œ</button>
          <button id="btnCompute" class="primary">è¨ˆç®—ä¸‹å±€å‹ç‡</button>
          <button id="btnReset" class="danger">é‡è¨­æ–°ç‰Œé´</button>
        </div>
        <div class="row" style="margin-top:10px; align-items:center;">
          <div style="display:flex; align-items:center; gap:10px;">
            <input id="autoSave" type="checkbox" checked><label for="autoSave">è‡ªå‹•å„²å­˜ï¼ˆlocalStorageï¼‰</label>
          </div>
          <button id="btnClearStore">æ¸…é™¤å„²å­˜</button>
        </div>
        <div class="hint">æ¯å±€æŠŠæ–°é–‹å‡ºçš„ç‰Œè£œé€²ä¾†å†æŒ‰ã€Œè¨ˆç®—ã€ã€‚</div>
      </div>
    </div>

    <div class="card">
      <label>ç›®å‰å·²æ‰£é™¤çš„ç‰Œ</label>
      <div id="removed" class="chips"></div>
      <div class="row" style="margin-top:6px;">
        <small>ç¸½è¨ˆå·²æ‰£ï¼š<span id="removedCount">0</span> å¼µï¼›å‰©é¤˜ï¼š<span id="remainCount">0</span> å¼µ</small>
      </div>
    </div>

    <div class="card">
      <label>çµæœ</label>
      <div class="stats">
        <div class="stat"><h3>èŠ (Banker)</h3><div id="bank" class="v">-</div></div>
        <div class="stat"><h3>é–’ (Player)</h3><div id="play" class="v">-</div></div>
        <div class="stat"><h3>å’Œ (Tie)</h3><div id="tie" class="v">-</div></div>
        <div class="stat"><h3>æ¨¡æ“¬å±€æ•¸</h3><div id="n" class="v">-</div></div>
      </div>
    </div>

    <div class="card">
      <div class="row" style="align-items:center;">
        <div style="flex:1 1 auto;"><label>æ­·å²çµæœè¶¨å‹¢</label></div>
        <div style="display:flex; gap:8px;">
          <button id="btnExport">åŒ¯å‡º CSV</button>
          <button id="btnClearHist" class="danger">æ¸…ç©ºæ­·å²</button>
        </div>
      </div>
      <canvas id="trend" style="width:100%;max-height:280px;"></canvas>
      <div style="overflow:auto; max-height:220px; margin-top:8px;">
        <table id="histTable">
          <thead><tr><th>#</th><th>æ™‚é–“</th><th>æ‰£ç‰Œæ•¸</th><th>å‰©é¤˜</th><th>Trials</th><th>Seed</th><th>é–’%</th><th>èŠ%</th><th>å’Œ%</th></tr></thead>
          <tbody></tbody>
        </table>
      </div>
    </div>

    <div class="card">
      <div class="roadTitle"><b>å¤§è·¯ / å¤§çœ¼ä»” / å°è·¯ / æ›±ç”´è·¯</b><small>ï¼ˆç²¾ç°¡ç¤ºç¯„ï¼Œä¿ç•™è¨ˆç®—æ ¸å¿ƒï¼‰</small></div>
      <div class="scrollX"><canvas id="bigRoad" class="road"></canvas></div>
    </div>

    <div class="card" style="text-align:center; color:#94a3b8;">èˆ‡ v4.2 å…±å­˜ï¼šé€™å€‹ç‰ˆæœ¬åœ¨ /v45 å­è³‡æ–™å¤¾ã€‚</div>
  </div>

  <script src="./v45_core.js"></script>
  <script>
    // å¼·åˆ¶æ›´æ–°å¿«å–
    document.getElementById('btnForceUpdate').onclick=async()=>{
      try{
        if('serviceWorker' in navigator){
          const regs = await navigator.serviceWorker.getRegistrations();
          for(const r of regs){ if(r.scope.includes('/v45/')) await r.unregister(); }
        }
        const keys = await caches.keys();
        await Promise.all(keys.filter(k=>k.includes('v45')).map(k=>caches.delete(k)));
        alert('å·²æ¸…é™¤ v45 å¿«å–èˆ‡ SWï¼Œé‡æ–°è¼‰å…¥ä¸­â€¦'); location.reload(true);
      }catch(e){ alert('æ¸…é™¤å¿«å–æ™‚ç™¼ç”ŸéŒ¯èª¤ï¼š'+e); }
    };
    document.getElementById('btnForceClearAll').onclick=()=>{
      if(!confirm('ç¢ºå®šæ¸…é™¤æ‰€æœ‰è³‡æ–™ï¼Ÿï¼ˆåŒ…å«æ‰£ç‰Œã€æ­·å²ã€è·¯åœ–ï¼‰')) return;
      try{ localStorage.clear(); alert('å·²æ¸…é™¤æœ¬æ©Ÿè³‡æ–™'); location.reload(); }catch(e){ alert('å¤±æ•—ï¼š'+e); }
    };

    // è¨»å†Š v45 å°ˆå±¬ SWï¼ˆscope ä¾·é™ /v45ï¼‰
    if('serviceWorker' in navigator){
      window.addEventListener('load', ()=>{
        navigator.serviceWorker.register('./sw.js'); // scope è‡ªå‹•ç‚º /v45/
      });
    }
  </script>
</body>
</html>
